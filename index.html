<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All in One Map Component</title>

  <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://github.com/downloads/lafeber/world-flags-sprite/flags32.css" />

  <style>
    #container {
      height: 500px;
      min-width: 310px;
      max-width: 800px;
      margin: 0 auto;
    }

    .highcharts-tooltip>span {
      padding: 10px;
      white-space: normal !important;
      width: 200px;
    }

    .loading {
      margin-top: 10em;
      text-align: center;
      color: gray;
    }

    .f32 .flag {
      vertical-align: middle !important;
    }
  </style>
</head>

<body>
  <div id="container"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.6/proj4.js"></script>
  <script src="https://code.highcharts.com/maps/highmaps.js"></script>
  <script src="https://code.highcharts.com/maps/modules/data.js"></script>
  <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>

  <script>
    const tempGoogleTrends = [];


    const data_googleTrends = [
      {
        "code3": "AFG",
        "name": "Afghanistan",
        "value": 498,
        "code": "AF"
      },
      {
        "code3": "USA",
        "name": "United States",
        "value": 83,
        "code": "US"
      },
      {
        "code3": "VNM",
        "name": "Vietnam",
        "value": 256,
        "code": "VN"
      },
      {
        "code3": "RUS",
        "name": "Russian Federation",
        "value": 10,
        "code": "RU"
      },
      {
        "code3": "CHN",
        "name": "China",
        "value": 156,
        "code": "CH"
      },
    ];

    const data_history = [
      {
        name: 'London',
        lat: 51.507222,
        lon: -0.1275,

        marker: {
          symbol: 'diamond',
          fillColor: '#29a329'
        }
      },
      {
        name: 'Brussel',
        lat: 50.8985400058829,
        lon: 4.483022689819336,

        marker: {
          symbol: 'diamond',
          fillColor: '#29a329'
        }
      },
      {
        name: 'Pristina',
        lat: 42.574261,
        lon: 21.028887,

        marker: {
          symbol: 'diamond',
          fillColor: '#29a329'
        }
      },
      {
        name: 'Newington',
        lat: -37.92715,
        lon: 143.82485,

        marker: {
          symbol: 'circle',
          fillColor: '#ff4d4d'
        }
      }
    ];

    const data_locations = [
      {
        type: 'Gym Location',
        "country": "RU",
        "name": "Moscow",
        "lat": "55.75222",
        "lon": "37.61556",
        marker: {
          symbol: 'url(gym.png)'
        }
      },
      {
        type: 'Born Location',
        "country": "JP",
        "name": "Tokyo",
        "lat": "35.6895",
        "lon": "139.69171",
        marker: {
          symbol: 'url(location.png)'
        }
      },
      {
        type: 'Twitter Location',
        "country": "US",
        "name": "New York City",
        "lat": "40.71427",
        "lon": "-74.00597",
        marker: {
          symbol: 'url(twitter.png)'
        }
      },
    ];

    data_googleTrends.forEach(function (el) {
      el.value = (el.value < 1 ? 1 : el.value);
    });

    const map = Highcharts.mapChart('container', {
      chart: {
        map: 'custom/world',
        borderWidth: 1,
        animation: false
      },

      title: {
        text: 'Fighter Information'
      },

      mapNavigation: {
        enabled: true,
        buttonOptions: {
          verticalAlign: 'top'
        }
      },

      tooltip: {
        backgroundColor: 'none',
        borderWidth: 0,
        shadow: false,
        useHTML: true,
        padding: 0,
        useHTML: true,
        positioner: function () {
          return { x: 0, y: 250 };
        },

        formatter: function(){
          if(this.point.series.name === 'Location'){
            return `
              ${this.point.type}<br>
              <span style="font-size:16px">${this.point.name}</span>
            `;
          }else if(this.point.series.name === 'History'){
            return `
              ${this.point.series.name}<br>
              <span style="font-size:16px">${this.point.name}</span>
            `;
          }

          return `
            <span class="f32">
              <span class="flag ${this.point.properties['hc-key']}"></span>
            </span> 
            ${this.point.name}<br>
            <span style="font-size:16px">Google trends: ${this.point.value}</span>
          `;
        }
      },

      // tooltip: {
      //   formatter: function(){
      //     console.log(this);
      //     return 'Position is ' + this.x + ', ' + this.long;
      //   }
      // },

      colorAxis: {
        min: 0,
        stops: [
          [0, '#EFEFFF'],
          [0.5, Highcharts.getOptions().colors[0]],
          [1, Highcharts.color(Highcharts.getOptions().colors[0]).brighten(-0.5).get()]
        ]
      },

      series: [
        {
          mapData: Highcharts.maps['custom/world']
        },
        
        { // History
          type: 'mappoint',
          name: 'History',
          zIndex: 30,
          lineWidth: 2,

          marker: {
            radius: 6,
          },

          data: data_history,
        },

        { // Location
          type: 'mappoint',
          name: 'Location',
          zIndex: 40,

          marker: {
            fillColor: '#0F0'
          },

          data: data_locations
        },


        { // Trends
          data: data_googleTrends,
          joinBy: ['iso-a3', 'code3'],
          name: 'Google trends',
          states: {
            hover: {
              color: '#a4edba'
            }
          }
        },
      ],
    });
  </script>
</body>

</html>